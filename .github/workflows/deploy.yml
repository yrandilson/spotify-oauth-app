name: Deploy to GitHub Pages

# Quando executar este workflow
on:
  # Executar quando houver push na branch main
  push:
    branches: [ main ]
  
  # Permitir execu√ß√£o manual do workflow
  workflow_dispatch:

# Permiss√µes necess√°rias para publicar no GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Evitar execu√ß√µes simult√¢neas
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # Job de build e deploy
  deploy:
    name: Build e Deploy
    runs-on: ubuntu-latest
    
    # Configura√ß√£o do ambiente GitHub Pages
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
      # 1. Fazer checkout do c√≥digo
      - name: Checkout do reposit√≥rio
        uses: actions/checkout@v4
      
      # 2. Injetar o CLIENT_ID no c√≥digo
      - name: Injetar Client ID
        run: |
          echo "üîê Injetando CLIENT_ID no app.js..."
          sed -i "s/YOUR_CLIENT_ID_HERE/${{ secrets.SPOTIFY_CLIENT_ID }}/g" app.js
          echo "‚úÖ CLIENT_ID injetado com sucesso!"
      
      # 3. Verificar se a inje√ß√£o funcionou (sem expor o valor)
      - name: Verificar inje√ß√£o
        run: |
          if grep -q "YOUR_CLIENT_ID_HERE" app.js; then
            echo "‚ùå ERRO: CLIENT_ID n√£o foi injetado!"
            exit 1
          else
            echo "‚úÖ CLIENT_ID foi injetado corretamente"
          fi
      
      # 4. Configurar GitHub Pages
      - name: Configurar Pages
        uses: actions/configure-pages@v4
      
      # 5. Fazer upload dos arquivos
      - name: Upload dos artefatos
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'
      
      # 6. Deploy para GitHub Pages
      - name: Deploy para GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
      
      # 7. Mostrar URL final
      - name: Mostrar URL
        run: |
          echo "üöÄ Deploy conclu√≠do!"
          echo "üìç URL: ${{ steps.deployment.outputs.page_url }}"